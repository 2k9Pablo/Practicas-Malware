.global _start
.text
_start:
	
	# Abrir el archivo
    # Mover la cadena literal en los registros (en little endian)
    movq $0x7361702f6374652f, %r12   # "sap/cte/" en %rdi
    movq $0x647773ffffffffff, %r11    # "dws" en %rsi  

    shr $40, %r11
    pushq %r11
    pushq %r12

	# OpCode 2 (open) into rax
	movq $0x02ffffffffffffff, %rax
    shr $56, %rax
	
	# Movemos el filename to rdi (1st arg)
	movq %rsp, %rdi

	# Movemos a rsi el modo de lectura
	xor %rsi, %rsi

	# Movemos buffer size
	movq $0x30363434ffffffff, %rdx
    shr $32, %rdx
	syscall

	# Movemos a r12 (local var) el contenido retornado por la syscall 
	movq %rax, %r12

    # Reservamos espacio para el buffer
    subq $64, %rsp

loop:
    
    # 0
    xor %r10, %r10

	# OpCode 0 (read) into rax
	movq %r10, %rax 

	# File descriptor
	movq %r12, %rdi

	# Buffer
	movq %rsp, %rsi
    
	movq $0x40ffffffffffffff, %rdx			# Buffer size
	shr $56, %rdx
	
	syscall

	# Check if it is eof
    xor %r10, %r10
	cmpq %r10, %rax
	
	# If %rax == 0, jump done
	je done

	movq %rax, %r15

	# Opcode 1 to write
	movq $0x01ffffffffffffff, %rax
    shr $56, %rax

	movq $0x01ffffffffffffff, %rdi	# File descriptor de stdout
    shr $56, %rdi

	# Buffer
	movq %rsp, %rsi
	movq %r15, %rdx			# Buffer size 

	syscall

	jmp loop

done:

	# OpCode close into rax
	movq $0x03ffffffffffffff, %rax			# Cerramos el fd
    shr $56, %rax
	movq %r12, %rdi
	syscall


	# OpCode 60 to exit the program
	movq $0x3Cffffffffffffff, %rax
    shr $56, %rax
	syscall
